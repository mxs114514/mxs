# 📅 2025.11.27 揭开“黑盒”的一天：从类型契约到云端直传

> 🌤️ **心情/状态**：以前看 `api.d.ts` 和上传代码就像看天书，只会复制粘贴。今天把它们拆解开来，那种“原来如此”的通透感太爽了。感觉自己从一个“代码搬运工”变成了一个懂原理的“工程师”。

## 💡 今日份“顿悟”

今天最大的冲击是关于 **“数据的单一来源”** 和 **“代码坏味道”**。
以前我满世界写 `http://cnd.hackerda.cn/...`，觉得能跑就行。今天被 AI 指出这是“坏味道”时，我才意识到：**数据库存“相对路径”是为了灵活性，前端拼“绝对路径”是为了展示。**
中间这个拼接的过程，就是架构设计的价值所在。一旦域名变了，我只需要改一个常量，而不是去修几千行代码。写代码真的不能只顾眼前，得给未来的自己留条后路。

## 🧠 知识内化（我的理解）

1. **关于 `api.d.ts`（接口契约）**：
   **现在的理解：** 它是后端给我的“说明书”和“保镖”。它不仅告诉我接口长啥样（代码提示），还会在我传错参数类型时（比如把数字传成字符串）直接拦住我。它是自动化生成的，意味着只要后端改了，我这边立马就能知道，不用再猜谜语了。

2. **关于“云存储直传”流程**：
   以前写上传功能就是盲目抄 `uploadPic`，根本不知道图片去哪了。
   **现在的理解：** 这是一个三方协作的接力赛。
   * **第一棒（后端）**：给我发“通行证”（临时密钥），而不是直接帮我传文件（省服务器带宽）。
   * **第二棒（前端）**：拿着通行证，直接把图片扔给腾讯云（COS）。
   * **第三棒（腾讯云）**：收货，告诉我文件名。
   * **冲刺**：我把文件名拼上 CDN 域名，存给后端。
   逻辑闭环了！

3. **关于 CDN 与 路径存储**：
   **“相对路径”是里子，“绝对路径”是面子。** 数据库里只存 `cat/avatar/1.jpg`（里子），干净纯粹；前端展示时再拼上 `https://cdn...`（面子）。这样以后换 CDN 服务商，里子不用动，换张皮（修改 `getCDNUrl`）就行了。

## 🚀 接下来我要做什么（Action Items）

* [ ] **[深入 TS]**：尝试读一下 `api.d.ts` 的源码，看看那些复杂的泛型是怎么生成的，加深对 TypeScript 类型系统的理解。

## 💭 碎碎念

原来那些看起来高大上的“云开发”、“CDN加速”，拆解到底层，其实就是一次次精密的 HTTP 请求和字符串拼接。技术祛魅之后，感觉自己变强了。
对了，今天 AI 说的“代码坏味道”这个词我很喜欢，不优雅。
