# Agent 方向学习规划 - 项目实战（PhotoCoach Agent）

最后更新：2026-01-17
返回索引：[agent方向的规划.md](./agent方向的规划.md)

---

## 项目实战（PhotoCoach Agent）

### 7. 主项目建议（摄影主线，React 作品集）

项目名（暂定）：PhotoCoach Agent（摄影教练 + 拍摄规划）

#### MVP（2 周内可演示）
- 技术选型：Next.js（React 框架），用它完成“产品闭环”（UI + 服务端能力）
- 核心功能 1：拍摄需求 → 可执行拍摄清单（场景、器材、参数建议、构图要点、注意事项）
- 核心功能 2：去过的地方总结（输入行程/地点/照片/笔记 → 生成结构化总结 + 亮点回顾 + 下次建议）
- 工具调用（白名单）：读取 EXIF（上传照片/JSON）、天气/日出日落（可选）、本地笔记检索（简化版）
- 可视化轨迹：展示 Agent 的“计划→调用工具→生成结果”的步骤记录
 
#### 进阶（4-8 周）
- RAG：导入你的摄影笔记/器材清单/课程资料，回答时附“引用片段”
- 可靠性：失败重试、超时降级（无工具时仍可给通用建议）、敏感/不确定提示
- 评估：20-50 条用例集（不同题材/光线/镜头），做自动回归（质量+成本+延迟）

#### 秋招加分点（简历可写）
- 受控 Agent（工具白名单 + 权限隔离 + 轨迹可观测）
- RAG 可追溯（引用 + 更新策略）
- 可量化评估（用例集 + 指标面板）

---

### 9. MVP 关键交互（建议按此实现）

1) 导入照片 → 自动读 EXIF（若无 GPS 则进入“地点推测/手动选点”）
2) 地点确认 → 形成“地点卡片”（名称/坐标/时间/照片集合）
3) 生成“去过的地方总结”→ 选择风格 → 产出 Markdown → 可编辑 → 导出
4) 生成“拍摄规划清单”→ 面向下次出行/下一次拍摄的可执行清单

---

### 12. 2 周 MVP 任务拆解（按天，3-5 小时/天）

#### Week 1：跑通“上传→定位→总结→导出”闭环
- Day 1：工程初始化（Next.js + pnpm）、基础页面/路由、UI 框架选型（先轻量即可）、环境变量方案
- Day 2：Supabase 初始化（Auth/DB/Storage）、邮箱密码登录/注册、基本权限与会话保持
- Day 3：照片上传（直传 Storage）、上传进度/失败重试、生成可访问的公开链接
- Day 4：EXIF 解析（提取时间/相机/镜头/GPS）、无 GPS 的分支处理
- Day 5：坐标链路打通（WGS84→GCJ-02）、高德地图接入（展示照片点位 + Marker 拖拽）
- Day 6：地点搜索与选点（关键词搜索→定位→拖拽微调）、逆地理编码得到地点名、地点确认流程（对/不对）
- Day 7：地点卡片与聚合（同一地点照片分组、按时间排序）、“去过的地方”列表页（基础可用）

#### Week 2：加入 Agent（受控工具调用）+ 文案风格 + 部署
- Day 8：LLM 服务端封装（统一接口：OpenAI/Gemini/Claude 任一先跑通）、流式输出到前端
- Day 9：工具白名单（读取 EXIF/地点信息/行程输入/用户偏好）、结构化输出（JSON schema）与校验
- Day 10：“去过的地方总结”Agent（风格：小红书/旅行日志）、生成 Markdown、编辑器（Markdown）与导出
- Day 11：“拍摄规划清单”Agent（输入：题材/器材/时段/地点），输出结构化清单（可打勾/收藏）
- Day 12：轨迹可视化（展示：计划→调用工具→生成结果）、日志与错误提示（用户可理解）
- Day 13：部署到腾讯云 + 1Panel（Node/容器二选一）、Nginx 反代、域名绑定、HTTPS 证书（Let’s Encrypt）
- Day 14：用例集（≥20 条）+ 回归脚本（手动/半自动均可）、README/截图/演示脚本（面试材料）

---

### 10. 关键技术选型（当前建议）

#### 地图（地点搜索 + 拖拽选点）
- 推荐：高德地图 AMap Web JS API（更贴合国内 POI 搜索与可用性，也满足“搜索→定位→拖拽微调”）
- 关键能力：地点/POI 搜索、Marker 拖拽选点、逆地理编码（坐标→地点名）
- 注意：照片 EXIF GPS 通常是 WGS84；国内地图多为 GCJ-02，需要做坐标转换后再在地图上标点/搜索

#### 云端（跨设备同步）
- 结论：需要上云（手机/电脑跨设备使用）
- 推荐：Supabase（Auth + Postgres + Storage，上手快、社区大、适合做产品 Demo）
- 备选：Vercel Postgres + Blob；或国内生态（腾讯云 CloudBase / 自建）

---

### 13. 部署约束（已确认）

- 面板：1Panel（Linux）
- 包管理：pnpm
- 上云：Supabase（Auth + Postgres + Storage）
- 地图：高德 AMap（仅国内）
- 域名：moxiaoshuai.fun
- 子域名：photo.moxiaoshuai.fun（用于本项目）
- 服务器信息（来自 1Panel）：发行版 ubuntu；内核 5.15.0-113-generic（具体 Ubuntu 版本号待确认）
- 服务器公网 IP：43.140.218.233
- DNS 服务商：腾讯云

---

### 15. 上线操作清单（腾讯云 DNS + 1Panel + HTTPS）

#### 15.1 DNS（腾讯云解析）
- 记录类型：A
- 主机记录：photo
- 记录值：43.140.218.233
- TTL：默认即可（先用 600 秒也行）
- 验证：等待解析生效后，用 `ping photo.moxiaoshuai.fun` 或在线 DNS 查询确认已指向该 IP

#### 15.2 服务器与网络
- 安全组/防火墙：放行入站 TCP 80、443（Let’s Encrypt 的 HTTP 校验需要 80）
- 端口占用：确保 80/443 没被其他服务占用（后续由 1Panel/Nginx 接管）

#### 15.3 1Panel（网站 + 反向代理）
- 新建网站：域名填写 `photo.moxiaoshuai.fun`
- 网站类型：反向代理（或先建静态站点也可，最终都要反代到 Next.js）
- 上游地址：`http://127.0.0.1:3000`（约定 Next.js 服务监听 3000）
- 健康检查：能打开网站首页即通过

#### 15.4 1Panel（HTTPS 证书）
- 申请证书：Let’s Encrypt
- 验证方式：HTTP-01（要求 80 可访问）
- 开启 HTTPS：证书签发后启用强制 HTTPS（可选，但建议开启）

#### 15.5 Next.js 服务常驻（两种常见方式）
- 方式 A（更省事）：Docker 部署（构建镜像并以容器方式常驻，对 1Panel 更友好）
- 方式 B（更传统）：Node + pm2（服务器上 `pnpm build` 后用 pm2 运行 `pnpm start`）

#### 15.6 最小验收
- `https://photo.moxiaoshuai.fun` 可打开（手机网络也能访问）
- 登录/注册可用（Supabase Auth）
- 照片可上传并拿到公开链接（Supabase Storage）

---

### 16. 决策记录（上线常驻方案）

- 默认选择：Docker（更适合 1Panel；依赖隔离、可复现、便于升级回滚）
- 备选：Node + pm2（适合你想更深入理解 Node 部署/进程管理的场景）

#### 已确认（2026-01-17）
- 选择方案：方式 A（Docker）

---

### 17. Docker 上线步骤（命令级，可照做）

目标：在服务器用 Docker 常驻运行 Next.js（监听 3000），由 1Panel/Nginx 反代到 `https://photo.moxiaoshuai.fun`

#### 17.1 代码侧（仓库需要准备的文件）
- `Dockerfile`：用于构建并运行 Next.js
- `.dockerignore`：排除 `node_modules`、构建缓存等
- `.env.example`：列出必须的环境变量（不提交真实密钥）

#### 17.2 服务器侧（1Panel）
- 确认已安装 Docker（1Panel 一般可一键安装/管理）
- 建议创建一个工作目录（如 `/opt/photo-coach/`）用于拉取代码与构建镜像

#### 17.3 构建与运行（两种路径，二选一）

路径 A（推荐，最简单）：服务器直接从 Git 拉代码并构建
- `git clone` 拉取项目代码到服务器
- 在项目目录执行 `docker build -t photo-coach:latest .`
- 运行容器：将容器端口 `3000` 映射到服务器本机 `3000`（或只绑定到 `127.0.0.1:3000`）

路径 B：本地构建镜像 → 推到镜像仓库 → 服务器拉取运行
- 适合：你不想在服务器上装构建依赖、或需要更稳定的发布流程

#### 17.4 1Panel 网站反向代理
- 新建网站：`photo.moxiaoshuai.fun`
- 反向代理上游：`http://127.0.0.1:3000`
- 申请 Let’s Encrypt 证书并启用 HTTPS

#### 17.5 MVP 最小环境变量（建议）
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`（仅服务端用，禁止暴露到前端）
- `NEXT_PUBLIC_AMAP_KEY`

---

